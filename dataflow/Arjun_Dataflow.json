{
	"name": "Arjun_Dataflow",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "dataset_productsRefined_transform",
						"type": "DatasetReference"
					},
					"name": "productRefined"
				},
				{
					"dataset": {
						"referenceName": "dataset_productsRefined_transform",
						"type": "DatasetReference"
					},
					"name": "ProductRefined2"
				},
				{
					"dataset": {
						"referenceName": "dataset_productsRefined_transform",
						"type": "DatasetReference"
					},
					"name": "ProductRefined3"
				},
				{
					"dataset": {
						"referenceName": "TransactionREfinedASQL",
						"type": "DatasetReference"
					},
					"name": "transactionRefined"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "BestProductBasedOnReviewSQL",
						"type": "DatasetReference"
					},
					"name": "BestProductBasedOnReview"
				},
				{
					"dataset": {
						"referenceName": "BestCategoryBasedOnReview",
						"type": "DatasetReference"
					},
					"name": "BestCategoryBasedOnReview"
				}
			],
			"transformations": [
				{
					"name": "sort1"
				},
				{
					"name": "averageReviewValue"
				},
				{
					"name": "sortAvgRating"
				},
				{
					"name": "groupByProductID"
				},
				{
					"name": "TRjoinPR"
				},
				{
					"name": "nullValuesSplit"
				}
			],
			"scriptLines": [
				"source(output(",
				"          id as string,",
				"          product_url as string,",
				"          color as string,",
				"          size as string,",
				"          width as integer,",
				"          brand_name as string,",
				"          brand_name_en as string,",
				"          model_name as string,",
				"          is_tbyb as boolean,",
				"          tags as string,",
				"          is_ditto as boolean,",
				"          classification as string,",
				"          specifications as string,",
				"          wishlistCount as integer,",
				"          purchaseCount as integer,",
				"          avgRating as integer,",
				"          totalNoOfRatings as integer,",
				"          hashtagList as string,",
				"          offerName as string,",
				"          cmsLinkIos as string,",
				"          qty as integer,",
				"          subCollection as string,",
				"          subCollectionId as string,",
				"          isCygnusEnabled as boolean,",
				"          isCashbackApplicable as boolean,",
				"          searchProductName as string,",
				"          Market_Price as integer,",
				"          Lenskart_Price as integer,",
				"          Discount_Percentage as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> productRefined",
				"source(output(",
				"          id as string,",
				"          product_url as string,",
				"          color as string,",
				"          size as string,",
				"          width as integer,",
				"          brand_name as string,",
				"          brand_name_en as string,",
				"          model_name as string,",
				"          is_tbyb as boolean,",
				"          tags as string,",
				"          is_ditto as boolean,",
				"          classification as string,",
				"          specifications as string,",
				"          wishlistCount as integer,",
				"          purchaseCount as integer,",
				"          avgRating as integer,",
				"          totalNoOfRatings as integer,",
				"          hashtagList as string,",
				"          offerName as string,",
				"          cmsLinkIos as string,",
				"          qty as integer,",
				"          subCollection as string,",
				"          subCollectionId as string,",
				"          isCygnusEnabled as boolean,",
				"          isCashbackApplicable as boolean,",
				"          searchProductName as string,",
				"          Market_Price as integer,",
				"          Lenskart_Price as integer,",
				"          Discount_Percentage as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> ProductRefined2",
				"source(output(",
				"          id as string,",
				"          product_url as string,",
				"          color as string,",
				"          size as string,",
				"          width as integer,",
				"          brand_name as string,",
				"          brand_name_en as string,",
				"          model_name as string,",
				"          is_tbyb as boolean,",
				"          tags as string,",
				"          is_ditto as boolean,",
				"          classification as string,",
				"          specifications as string,",
				"          wishlistCount as integer,",
				"          purchaseCount as integer,",
				"          avgRating as integer,",
				"          totalNoOfRatings as integer,",
				"          hashtagList as string,",
				"          offerName as string,",
				"          cmsLinkIos as string,",
				"          qty as integer,",
				"          subCollection as string,",
				"          subCollectionId as string,",
				"          isCygnusEnabled as boolean,",
				"          isCashbackApplicable as boolean,",
				"          searchProductName as string,",
				"          Market_Price as integer,",
				"          Lenskart_Price as integer,",
				"          Discount_Percentage as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> ProductRefined3",
				"source(output(",
				"          customer_id as string,",
				"          product_id as string,",
				"          quantity as integer,",
				"          transaction_date as date,",
				"          transaction_id as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> transactionRefined",
				"productRefined sort(desc(avgRating, true)) ~> sort1",
				"ProductRefined2 aggregate(groupBy(classification),",
				"     avgRating = avg(avgRating)) ~> averageReviewValue",
				"averageReviewValue sort(desc(avgRating, true)) ~> sortAvgRating",
				"transactionRefined aggregate(groupBy(product_id),",
				"     quantity = sum(quantity)) ~> groupByProductID",
				"groupByProductID, ProductRefined3 join(product_id == id,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> TRjoinPR",
				"TRjoinPR split(isNull(id),",
				"     disjoint: true) ~> nullValuesSplit@(nullVals, nonNullVals)",
				"sort1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          id,",
				"          product_url,",
				"          color,",
				"          size,",
				"          width,",
				"          brand_name_en,",
				"          model_name,",
				"          classification,",
				"          avgRating,",
				"          searchProductName,",
				"          Market_Price,",
				"          Lenskart_Price,",
				"          Discount_Percentage",
				"     )) ~> BestProductBasedOnReview",
				"sortAvgRating sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError') ~> BestCategoryBasedOnReview"
			]
		}
	}
}